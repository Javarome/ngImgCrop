{"version":3,"sources":["ng://ng-img-crop/src/app/fc-img-crop/classes/crop-pubsub.ts","ng://ng-img-crop/src/app/fc-img-crop/classes/crop-exif.ts","node_modules/tslib/tslib.es6.js","ng://ng-img-crop/src/app/fc-img-crop/classes/crop-canvas.ts","ng://ng-img-crop/src/app/fc-img-crop/classes/crop-area.ts","ng://ng-img-crop/src/app/fc-img-crop/classes/crop-area-circle.ts","ng://ng-img-crop/src/app/fc-img-crop/classes/crop-area-square.ts","ng://ng-img-crop/src/app/fc-img-crop/classes/crop-host.ts","ng://ng-img-crop/src/app/fc-img-crop/fc-img-crop.component.ts","ng://ng-img-crop/src/app/fc-img-crop/fc-img-crop.module.ts"],"names":["CropPubSub","prototype","on","names","handler","_this","this","split","forEach","name","events","push","trigger","args","listeners","call","CropEXIF","readIPTCData","file","startOffset","sectionLength","fieldValue","fieldName","dataSize","segmentType","dataView","DataView","data","segmentStartPos","getUint8","IptcFieldMap","getInt16","getStringFromDB","hasOwnProperty","Array","readTags","tiffStart","dirStart","strings","bigEnd","entryOffset","tag","i","entries","getUint16","tags","readTagValue","console","warn","offset","vals","val","n","numerator","denominator","type","numValues","getUint32","valueOffset","Number","getInt32","addEvent","element","event","addEventListener","attachEvent","objectURLToBlob","url","callback","http","XMLHttpRequest","open","responseType","onload","e","status","response","send","handleBinaryFile","binFile","img","findEXIFinJPEG","iptcdata","findIPTCinJPEG","exifdata","getImageData","src","test","arrayBuffer","base64ToArrayBuffer","fileReader","FileReader","target","result","blob","readAsArrayBuffer","self_1","window","Blob","File","debug","byteLength","buffer","start","length","outstr","String","fromCharCode","readEXIFData","error","exifData","gpsData","tiffOffset","firstIFDOffset","TiffTags","ExifIFDPointer","ExifTags","StringValues","Components","GPSInfoIFDPointer","GPSTags","getData","Image","HTMLImageElement","complete","imageHasData","getTag","getAllTags","a","pretty","strPretty","maxOffset","marker","someWord","readByte","someByte","segmentLength","nameHeaderLength","readFromBinaryFile","base64","contentType","match","replace","binary","atob","len","ArrayBuffer","view","Uint8Array","charCodeAt","0x9000","0xA000","0xA001","0xA002","0xA003","0x9101","0x9102","0x927C","0x9286","0xA004","0x9003","0x9004","0x9290","0x9291","0x9292","0x829A","0x829D","0x8822","0x8824","0x8827","0x8828","0x9201","0x9202","0x9203","0x9204","0x9205","0x9206","0x9207","0x9208","0x9209","0x9214","0x920A","0xA20B","0xA20C","0xA20E","0xA20F","0xA210","0xA214","0xA215","0xA217","0xA300","0xA301","0xA302","0xA401","0xA402","0xA403","0xA404","0xA405","0xA406","0xA407","0xA408","0xA409","0xA40A","0xA40B","0xA40C","0xA005","0xA420","0x0100","0x0101","0x8769","0x8825","0x0102","0x0103","0x0106","0x0112","0x0115","0x011C","0x0212","0x0213","0x011A","0x011B","0x0128","0x0111","0x0116","0x0117","0x0201","0x0202","0x012D","0x013E","0x013F","0x0211","0x0214","0x0132","0x010E","0x010F","0x0110","0x0131","0x013B","0x8298","0x0000","0x0001","0x0002","0x0003","0x0004","0x0005","0x0006","0x0007","0x0008","0x0009","0x000A","0x000B","0x000C","0x000D","0x000E","0x000F","0x0010","0x0011","0x0012","0x0013","0x0014","0x0015","0x0016","0x0017","0x0018","0x0019","0x001A","0x001B","0x001C","0x001D","0x001E","ExposureProgram","0","1","2","3","4","5","6","7","8","MeteringMode","255","LightSource","9","10","11","12","13","14","15","17","18","19","20","21","22","23","24","Flash","0x001F","0x0020","0x0041","0x0045","0x0047","0x0049","0x004D","0x004F","0x0059","0x005D","0x005F","SensingMethod","SceneCaptureType","SceneType","CustomRendered","WhiteBalance","GainControl","Contrast","Saturation","Sharpness","SubjectDistanceRange","FileSource","0x78","0x6E","0x19","0x37","0x50","0x55","0x7A","0x69","0x74","0x0F","extendStatics","d","b","Object","setPrototypeOf","__proto__","p","__extends","__","constructor","create","CropCanvas","ctx","areaOutline","resizeBoxStroke","resizeBoxFill","resizeBoxArrowFill","resizeCircleStroke","resizeCircleFill","moveIconFill","calcPoint","point","scale","drawFilledPolygon","shape","fillStyle","centerCoords","pc","save","beginPath","pc0","moveTo","pNum","parseInt","lineTo","fill","closePath","restore","drawIconMove","shapeArrowN","colors","shapeArrowW","shapeArrowS","shapeArrowE","drawIconResizeCircle","circleRadius","scaledCircleRadius","strokeStyle","lineWidth","arc","Math","PI","stroke","drawIconResizeBoxBase","boxSize","scaledBoxSize","fillRect","strokeRect","drawIconResizeBoxNESW","shapeArrowNE","shapeArrowSW","drawIconResizeBoxNWSE","shapeArrowNW","shapeArrowSE","drawCropArea","image","size","fnDrawClipPath","xRatio","width","canvas","yRatio","height","xLeft","yTop","clip","drawImage","CropArea","_ctx","_events","_cropCanvas","getImage","_image","setImage","getX","_x","setX","x","_dontDragOutside","getY","_y","setY","y","getSize","_size","setSize","max","_minSize","getMinSize","setMinSize","h","w","draw","_drawArea","CropAreaCircle","_super","_boxResizeNormalSize","_boxResizeBaseSize","_boxResizeNormalRatio","_boxResizeHoverSize","_boxResizeHoverRatio","tslib_1.__extends","_calcCirclePerimeterCoords","angleDegrees","hSize","angleRadians","cos","sin","_calcResizeIconCenterCoords","_isCoordWithinArea","coord","sqrt","_isCoordWithinBoxResize","resizeIconCenterCoords","apply","arguments","_areaIsHover","_iconMoveHoverRatio","_iconMoveNormalRatio","_boxResizeIsHover","processMouseMove","mouseCurX","mouseCurY","cursor","res","_areaIsDragging","_posDragStartX","_posDragStartY","_boxResizeIsDragging","iFR","iFX","iFY","_posResizeStartX","_posResizeStartY","_posResizeStartSize","style","processMouseDown","mouseDownX","mouseDownY","processMouseUp","CropAreaSquare","_resizeCtrlNormalRadius","_resizeCtrlBaseRadius","_resizeCtrlNormalRatio","_resizeCtrlHoverRadius","_resizeCtrlHoverRatio","_calcSquareCorners","_calcSquareDimensions","left","top","right","bottom","squareDimensions","_isCoordWithinResizeCtrl","resizeIconsCenterCoords","rect","_resizeCtrlIsHover","_resizeCtrlIsDragging","xMulti","yMulti","wasSize","posModifier","hoveredResizeBox","isWithinResizeCtrl","CropHost","elCanvas","opts","parentElement","getContext","cropArea","document","onMouseMove","bind","onMouseDown","onMouseUp","destroy","removeEventListener","remove","drawScene","clearRect","resetCropHost","cw","ch","imageWidth","imageHeight","imageRatio","canvasDims","maxCanvasDims","minCanvasDims","floor","marginLeft","marginTop","min","getChangedTouches","changedTouches","originalEvent","pageX","pageY","getElementOffset","preventDefault","stopPropagation","getResultImageDataURI","temp_canvas","createElement","temp_ctx","resultImageSize","resultImageQuality","toDataURL","resultImageFormat","redraw","setNewImageSource","imageSource","newImage","substring","toLowerCase","crossOrigin","orientation","cx","cy","deg","imageDone","setMaxDimensions","indexOf","rotate","onerror","curWidth","curHeight","setAreaMinSize","isNaN","setResultImageSize","setResultImageFormat","format","setResultImageQuality","quality","parseFloat","setAreaType","curSize","curMinSize","curX","curY","CropAreaType","getAreaDetails","elem","box","getBoundingClientRect","body","docElem","documentElement","scrollTop","pageYOffset","scrollLeft","pageXOffset","clientTop","clientLeft","round","FcImgCropComponent","el","ref","EventEmitter","ngOnInit","nativeElement","querySelector","cropHost","self","onLoadBegin","emit","detectChanges","onLoadDone","onImageReady","onLoadError","changeOnFly","updateResultImage","areaDetails","areaDetailsChange","resultImage","storedResultImage","resultImageChange","observers","onChange","$dataURI","ngOnDestroy","ngOnChanges","changes","areaType","areaMinSize","ngAfterViewInit","observer","MutationObserver","mutations","mutation","attributeName","clientWidth","clientHeight","observe","attributes","childList","characterData","Component","selector","template","ElementRef","ChangeDetectorRef","Input","Output","CropModule","NgModule","declarations","exports"],"mappings":"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","sourcesContent":["export class CropPubSub {\n  private events = {};\n\n  on(names: string, handler: Function) {\n    names.split(' ').forEach(name => {\n      if (!this.events[name]) {\n        this.events[name] = [];\n      }\n      this.events[name].push(handler);\n    });\n    return this;\n  };\n\n  // Publish\n  trigger(name: string, args: any[]) {\n    const listeners = this.events[name];\n    if (listeners) {\n      listeners.forEach(handler => {\n        handler.call(null, args);\n      });\n    }\n    return this;\n  };\n}","/**\n * EXIF service is based on the exif-js library (https://github.com/jseidelin/exif-js)\n */\nexport class CropEXIF {\n\n  static ExifTags = {\n\n    // version tags\n    '0x9000': \"ExifVersion\",             // EXIF version\n    '0xA000': \"FlashpixVersion\",         // Flashpix format version\n\n    // colorspace tags\n    '0xA001': \"ColorSpace\",              // Color space information tag\n\n    // image configuration\n    '0xA002': \"PixelXDimension\",         // Valid width of meaningful image\n    '0xA003': \"PixelYDimension\",         // Valid height of meaningful image\n    '0x9101': \"ComponentsConfiguration\", // Information about channels\n    '0x9102': \"CompressedBitsPerPixel\",  // Compressed bits per pixel\n\n    // user information\n    '0x927C': \"MakerNote\",               // Any desired information written by the manufacturer\n    '0x9286': \"UserComment\",             // Comments by user\n\n    // related file\n    '0xA004': \"RelatedSoundFile\",        // Name of related sound file\n\n    // date and time\n    '0x9003': \"DateTimeOriginal\",        // Date and time when the original image was generated\n    '0x9004': \"DateTimeDigitized\",       // Date and time when the image was stored digitally\n    '0x9290': \"SubsecTime\",              // Fractions of seconds for DateTime\n    '0x9291': \"SubsecTimeOriginal\",      // Fractions of seconds for DateTimeOriginal\n    '0x9292': \"SubsecTimeDigitized\",     // Fractions of seconds for DateTimeDigitized\n\n    // picture-taking conditions\n    '0x829A': \"ExposureTime\",            // Exposure time (in seconds)\n    '0x829D': \"FNumber\",                 // F number\n    '0x8822': \"ExposureProgram\",         // Exposure program\n    '0x8824': \"SpectralSensitivity\",     // Spectral sensitivity\n    '0x8827': \"ISOSpeedRatings\",         // ISO speed rating\n    '0x8828': \"OECF\",                    // Optoelectric conversion factor\n    '0x9201': \"ShutterSpeedValue\",       // Shutter speed\n    '0x9202': \"ApertureValue\",           // Lens aperture\n    '0x9203': \"BrightnessValue\",         // Value of brightness\n    '0x9204': \"ExposureBias\",            // Exposure bias\n    '0x9205': \"MaxApertureValue\",        // Smallest F number of lens\n    '0x9206': \"SubjectDistance\",         // Distance to subject in meters\n    '0x9207': \"MeteringMode\",            // Metering mode\n    '0x9208': \"LightSource\",             // Kind of light source\n    '0x9209': \"Flash\",                   // Flash status\n    '0x9214': \"SubjectArea\",             // Location and area of main subject\n    '0x920A': \"FocalLength\",             // Focal length of the lens in mm\n    '0xA20B': \"FlashEnergy\",             // Strobe energy in BCPS\n    '0xA20C': \"SpatialFrequencyResponse\",    //\n    '0xA20E': \"FocalPlaneXResolution\",   // Number of pixels in width direction per FocalPlaneResolutionUnit\n    '0xA20F': \"FocalPlaneYResolution\",   // Number of pixels in height direction per FocalPlaneResolutionUnit\n    '0xA210': \"FocalPlaneResolutionUnit\",    // Unit for measuring FocalPlaneXResolution and FocalPlaneYResolution\n    '0xA214': \"SubjectLocation\",         // Location of subject in image\n    '0xA215': \"ExposureIndex\",           // Exposure index selected on camera\n    '0xA217': \"SensingMethod\",           // Image sensor type\n    '0xA300': \"FileSource\",              // Image source (3 == DSC)\n    '0xA301': \"SceneType\",               // Scene type (1 == directly photographed)\n    '0xA302': \"CFAPattern\",              // Color filter array geometric pattern\n    '0xA401': \"CustomRendered\",          // Special processing\n    '0xA402': \"ExposureMode\",            // Exposure mode\n    '0xA403': \"WhiteBalance\",            // 1 = auto white balance, 2 = manual\n    '0xA404': \"DigitalZoomRation\",       // Digital zoom ratio\n    '0xA405': \"FocalLengthIn35mmFilm\",   // Equivalent foacl length assuming 35mm film camera (in mm)\n    '0xA406': \"SceneCaptureType\",        // Type of scene\n    '0xA407': \"GainControl\",             // Degree of overall image gain adjustment\n    '0xA408': \"Contrast\",                // Direction of contrast processing applied by camera\n    '0xA409': \"Saturation\",              // Direction of saturation processing applied by camera\n    '0xA40A': \"Sharpness\",               // Direction of sharpness processing applied by camera\n    '0xA40B': \"DeviceSettingDescription\",    //\n    '0xA40C': \"SubjectDistanceRange\",    // Distance to subject\n\n    // other tags\n    '0xA005': \"InteroperabilityIFDPointer\",\n    '0xA420': \"ImageUniqueID\"            // Identifier assigned uniquely to each image\n  };\n\n  static TiffTags = {\n    '0x0100': \"ImageWidth\",\n    '0x0101': \"ImageHeight\",\n    '0x8769': \"ExifIFDPointer\",\n    '0x8825': \"GPSInfoIFDPointer\",\n    '0xA005': \"InteroperabilityIFDPointer\",\n    '0x0102': \"BitsPerSample\",\n    '0x0103': \"Compression\",\n    '0x0106': \"PhotometricInterpretation\",\n    '0x0112': \"Orientation\",\n    '0x0115': \"SamplesPerPixel\",\n    '0x011C': \"PlanarConfiguration\",\n    '0x0212': \"YCbCrSubSampling\",\n    '0x0213': \"YCbCrPositioning\",\n    '0x011A': \"XResolution\",\n    '0x011B': \"YResolution\",\n    '0x0128': \"ResolutionUnit\",\n    '0x0111': \"StripOffsets\",\n    '0x0116': \"RowsPerStrip\",\n    '0x0117': \"StripByteCounts\",\n    '0x0201': \"JPEGInterchangeFormat\",\n    '0x0202': \"JPEGInterchangeFormatLength\",\n    '0x012D': \"TransferFunction\",\n    '0x013E': \"WhitePoint\",\n    '0x013F': \"PrimaryChromaticities\",\n    '0x0211': \"YCbCrCoefficients\",\n    '0x0214': \"ReferenceBlackWhite\",\n    '0x0132': \"DateTime\",\n    '0x010E': \"ImageDescription\",\n    '0x010F': \"Make\",\n    '0x0110': \"Model\",\n    '0x0131': \"Software\",\n    '0x013B': \"Artist\",\n    '0x8298': \"Copyright\"\n  };\n\n  static GPSTags = {\n    '0x0000': \"GPSVersionID\",\n    '0x0001': \"GPSLatitudeRef\",\n    '0x0002': \"GPSLatitude\",\n    '0x0003': \"GPSLongitudeRef\",\n    '0x0004': \"GPSLongitude\",\n    '0x0005': \"GPSAltitudeRef\",\n    '0x0006': \"GPSAltitude\",\n    '0x0007': \"GPSTimeStamp\",\n    '0x0008': \"GPSSatellites\",\n    '0x0009': \"GPSStatus\",\n    '0x000A': \"GPSMeasureMode\",\n    '0x000B': \"GPSDOP\",\n    '0x000C': \"GPSSpeedRef\",\n    '0x000D': \"GPSSpeed\",\n    '0x000E': \"GPSTrackRef\",\n    '0x000F': \"GPSTrack\",\n    '0x0010': \"GPSImgDirectionRef\",\n    '0x0011': \"GPSImgDirection\",\n    '0x0012': \"GPSMapDatum\",\n    '0x0013': \"GPSDestLatitudeRef\",\n    '0x0014': \"GPSDestLatitude\",\n    '0x0015': \"GPSDestLongitudeRef\",\n    '0x0016': \"GPSDestLongitude\",\n    '0x0017': \"GPSDestBearingRef\",\n    '0x0018': \"GPSDestBearing\",\n    '0x0019': \"GPSDestDistanceRef\",\n    '0x001A': \"GPSDestDistance\",\n    '0x001B': \"GPSProcessingMethod\",\n    '0x001C': \"GPSAreaInformation\",\n    '0x001D': \"GPSDateStamp\",\n    '0x001E': \"GPSDifferential\"\n  };\n\n  static StringValues = {\n    ExposureProgram: {\n      '0': \"Not defined\",\n      '1': \"Manual\",\n      '2': \"Normal program\",\n      '3': \"Aperture priority\",\n      '4': \"Shutter priority\",\n      '5': \"Creative program\",\n      '6': \"Action program\",\n      '7': \"Portrait mode\",\n      '8': \"Landscape mode\"\n    },\n    MeteringMode: {\n      '0': \"Unknown\",\n      '1': \"Average\",\n      '2': \"CenterWeightedAverage\",\n      '3': \"Spot\",\n      '4': \"MultiSpot\",\n      '5': \"Pattern\",\n      '6': \"Partial\",\n      '255': \"Other\"\n    },\n    LightSource: {\n      '0': \"Unknown\",\n      '1': \"Daylight\",\n      '2': \"Fluorescent\",\n      '3': \"Tungsten (incandescent light)\",\n      '4': \"Flash\",\n      '9': \"Fine weather\",\n      '10': \"Cloudy weather\",\n      '11': \"Shade\",\n      '12': \"Daylight fluorescent (D 5700 - 7100K)\",\n      '13': \"Day white fluorescent (N 4600 - 5400K)\",\n      '14': \"Cool white fluorescent (W 3900 - 4500K)\",\n      '15': \"White fluorescent (WW 3200 - 3700K)\",\n      '17': \"Standard light A\",\n      '18': \"Standard light B\",\n      '19': \"Standard light C\",\n      '20': \"D55\",\n      '21': \"D65\",\n      '22': \"D75\",\n      '23': \"D50\",\n      '24': \"ISO studio tungsten\",\n      '255': \"Other\"\n    },\n    Flash: {\n      '0x0000': \"Flash did not fire\",\n      '0x0001': \"Flash fired\",\n      '0x0005': \"Strobe return light not detected\",\n      '0x0007': \"Strobe return light detected\",\n      '0x0009': \"Flash fired, compulsory flash mode\",\n      '0x000D': \"Flash fired, compulsory flash mode, return light not detected\",\n      '0x000F': \"Flash fired, compulsory flash mode, return light detected\",\n      '0x0010': \"Flash did not fire, compulsory flash mode\",\n      '0x0018': \"Flash did not fire, auto mode\",\n      '0x0019': \"Flash fired, auto mode\",\n      '0x001D': \"Flash fired, auto mode, return light not detected\",\n      '0x001F': \"Flash fired, auto mode, return light detected\",\n      '0x0020': \"No flash function\",\n      '0x0041': \"Flash fired, red-eye reduction mode\",\n      '0x0045': \"Flash fired, red-eye reduction mode, return light not detected\",\n      '0x0047': \"Flash fired, red-eye reduction mode, return light detected\",\n      '0x0049': \"Flash fired, compulsory flash mode, red-eye reduction mode\",\n      '0x004D': \"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected\",\n      '0x004F': \"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected\",\n      '0x0059': \"Flash fired, auto mode, red-eye reduction mode\",\n      '0x005D': \"Flash fired, auto mode, return light not detected, red-eye reduction mode\",\n      '0x005F': \"Flash fired, auto mode, return light detected, red-eye reduction mode\"\n    },\n    SensingMethod: {\n      '1': \"Not defined\",\n      '2': \"One-chip color area sensor\",\n      '3': \"Two-chip color area sensor\",\n      '4': \"Three-chip color area sensor\",\n      '5': \"Color sequential area sensor\",\n      '7': \"Trilinear sensor\",\n      '8': \"Color sequential linear sensor\"\n    },\n    SceneCaptureType: {\n      '0': \"Standard\",\n      '1': \"Landscape\",\n      '2': \"Portrait\",\n      '3': \"Night scene\"\n    },\n    SceneType: {\n      '1': \"Directly photographed\"\n    },\n    CustomRendered: {\n      '0': \"Normal process\",\n      '1': \"Custom process\"\n    },\n    WhiteBalance: {\n      '0': \"Auto white balance\",\n      '1': \"Manual white balance\"\n    },\n    GainControl: {\n      '0': \"None\",\n      '1': \"Low gain up\",\n      '2': \"High gain up\",\n      '3': \"Low gain down\",\n      '4': \"High gain down\"\n    },\n    Contrast: {\n      '0': \"Normal\",\n      '1': \"Soft\",\n      '2': \"Hard\"\n    },\n    Saturation: {\n      '0': \"Normal\",\n      '1': \"Low saturation\",\n      '2': \"High saturation\"\n    },\n    Sharpness: {\n      '0': \"Normal\",\n      '1': \"Soft\",\n      '2': \"Hard\"\n    },\n    SubjectDistanceRange: {\n      '0': \"Unknown\",\n      '1': \"Macro\",\n      '2': \"Close view\",\n      '3': \"Distant view\"\n    },\n    FileSource: {\n      '3': \"DSC\"\n    },\n\n    Components: {\n      '0': \"\",\n      '1': \"Y\",\n      '2': \"Cb\",\n      '3': \"Cr\",\n      '4': \"R\",\n      '5': \"G\",\n      '6': \"B\"\n    }\n  };\n\n  static IptcFieldMap = {\n    '0x78': 'caption',\n    '0x6E': 'credit',\n    '0x19': 'keywords',\n    '0x37': 'dateCreated',\n    '0x50': 'byline',\n    '0x55': 'bylineTitle',\n    '0x7A': 'captionWriter',\n    '0x69': 'headline',\n    '0x74': 'copyright',\n    '0x0F': 'category'\n  };\n\n  static readIPTCData(file, startOffset, sectionLength) {\n    var dataView = new DataView(file);\n    var data = {};\n    var fieldValue, fieldName, dataSize, segmentType, segmentSize;\n    var segmentStartPos = startOffset;\n    while (segmentStartPos < startOffset + sectionLength) {\n      if (dataView.getUint8(segmentStartPos) === 0x1C && dataView.getUint8(segmentStartPos + 1) === 0x02) {\n        segmentType = dataView.getUint8(segmentStartPos + 2);\n        if (segmentType in CropEXIF.IptcFieldMap) {\n          dataSize = dataView.getInt16(segmentStartPos + 3);\n          segmentSize = dataSize + 5;\n          fieldName = CropEXIF.IptcFieldMap[segmentType];\n          fieldValue = CropEXIF.getStringFromDB(dataView, segmentStartPos + 5, dataSize);\n          // Check if we already stored a value with this name\n          if (data.hasOwnProperty(fieldName)) {\n            // Value already stored with this name, create multivalue field\n            if (data[fieldName] instanceof Array) {\n              data[fieldName].push(fieldValue);\n            }\n            else {\n              data[fieldName] = [data[fieldName], fieldValue];\n            }\n          }\n          else {\n            data[fieldName] = fieldValue;\n          }\n        }\n\n      }\n      segmentStartPos++;\n    }\n    return data;\n  }\n\n  static readTags(file, tiffStart, dirStart, strings, bigEnd): { [key: string]: any } {\n    var entries = file.getUint16(dirStart, !bigEnd),\n      tags = {},\n      entryOffset, tag,\n      i;\n\n    for (i = 0; i < entries; i++) {\n      entryOffset = dirStart + i * 12 + 2;\n      tag = strings[file.getUint16(entryOffset, !bigEnd)];\n      if (tag) {\n        tags[tag] = CropEXIF.readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd);\n      } else {\n        console.warn('Unknown tag: ' + file.getUint16(entryOffset, !bigEnd));\n      }\n    }\n    return tags;\n  }\n\n  static readTagValue(file, entryOffset, tiffStart, dirStart, bigEnd) {\n    var type = file.getUint16(entryOffset + 2, !bigEnd),\n      numValues = file.getUint32(entryOffset + 4, !bigEnd),\n      valueOffset = file.getUint32(entryOffset + 8, !bigEnd) + tiffStart,\n      offset,\n      vals, val, n,\n      numerator, denominator;\n\n    switch (type) {\n      case '1': // byte, 8-bit unsigned int\n      case '7': // undefined, 8-bit byte, value depending on field\n        if (numValues == 1) {\n          return file.getUint8(entryOffset + 8, !bigEnd);\n        } else {\n          offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n          vals = [];\n          for (n = 0; n < numValues; n++) {\n            vals[n] = file.getUint8(offset + n);\n          }\n          return vals;\n        }\n\n      case '2': // ascii, 8-bit byte\n        offset = numValues > 4 ? valueOffset : (entryOffset + 8);\n        return this.getStringFromDB(file, offset, numValues - 1);\n\n      case '3': // short, 16 bit int\n        if (numValues == 1) {\n          return file.getUint16(entryOffset + 8, !bigEnd);\n        } else {\n          offset = numValues > 2 ? valueOffset : (entryOffset + 8);\n          vals = [];\n          for (n = 0; n < numValues; n++) {\n            vals[n] = file.getUint16(offset + 2 * n, !bigEnd);\n          }\n          return vals;\n        }\n\n      case '4': // long, 32 bit int\n        if (numValues == 1) {\n          return file.getUint32(entryOffset + 8, !bigEnd);\n        } else {\n          vals = [];\n          for (n = 0; n < numValues; n++) {\n            vals[n] = file.getUint32(valueOffset + 4 * n, !bigEnd);\n          }\n          return vals;\n        }\n\n      case '5':    // rational = two long values, first is numerator, second is denominator\n        if (numValues == 1) {\n          numerator = file.getUint32(valueOffset, !bigEnd);\n          denominator = file.getUint32(valueOffset + 4, !bigEnd);\n          val = new Number(numerator / denominator);\n          val.numerator = numerator;\n          val.denominator = denominator;\n          return val;\n        } else {\n          vals = [];\n          for (n = 0; n < numValues; n++) {\n            numerator = file.getUint32(valueOffset + 8 * n, !bigEnd);\n            denominator = file.getUint32(valueOffset + 4 + 8 * n, !bigEnd);\n            vals[n] = new Number(numerator / denominator);\n            vals[n].numerator = numerator;\n            vals[n].denominator = denominator;\n          }\n          return vals;\n        }\n\n      case '9': // slong, 32 bit signed int\n        if (numValues == 1) {\n          return file.getInt32(entryOffset + 8, !bigEnd);\n        } else {\n          vals = [];\n          for (n = 0; n < numValues; n++) {\n            vals[n] = file.getInt32(valueOffset + 4 * n, !bigEnd);\n          }\n          return vals;\n        }\n\n      case '10': // signed rational, two slongs, first is numerator, second is denominator\n        if (numValues == 1) {\n          return file.getInt32(valueOffset, !bigEnd) / file.getInt32(valueOffset + 4, !bigEnd);\n        } else {\n          vals = [];\n          for (n = 0; n < numValues; n++) {\n            vals[n] = file.getInt32(valueOffset + 8 * n, !bigEnd) / file.getInt32(valueOffset + 4 + 8 * n, !bigEnd);\n          }\n          return vals;\n        }\n    }\n  }\n\n  static addEvent(element, event, handler) {\n    if (element.addEventListener) {\n      element.addEventListener(event, handler, false);\n    } else if (element.attachEvent) {\n      element.attachEvent(\"on\" + event, handler);\n    }\n  }\n\n  static objectURLToBlob(url, callback) {\n    var http = new XMLHttpRequest();\n    http.open(\"GET\", url, true);\n    http.responseType = \"blob\";\n    http.onload = function (e) {\n      if (this.status == 200 || this.status === 0) {\n        callback(this.response);\n      }\n    };\n    http.send();\n  }\n\n  static handleBinaryFile(binFile, img, callback?) {\n    var data = CropEXIF.findEXIFinJPEG(binFile);\n    var iptcdata = CropEXIF.findIPTCinJPEG(binFile);\n    img.exifdata = data || {};\n    img.iptcdata = iptcdata || {};\n    if (callback) {\n      callback.call(img);\n    }\n  }\n\n  static getImageData(img, callback) {\n    if (img.src) {\n      if (/^data\\:/i.test(img.src)) { // Data URI\n        var arrayBuffer = CropEXIF.base64ToArrayBuffer(img.src);\n        this.handleBinaryFile(arrayBuffer, img, callback);\n\n      } else if (/^blob\\:/i.test(img.src)) { // Object URL\n        var fileReader = new FileReader();\n        fileReader.onload = (e) => {\n          this.handleBinaryFile(e.target.result, img, callback);\n        };\n        CropEXIF.objectURLToBlob(img.src, function (blob) {\n          fileReader.readAsArrayBuffer(blob);\n        });\n      } else {\n        var http = new XMLHttpRequest();\n        const self = this;\n        http.onload = function () {\n          if (this.status == 200 || this.status === 0) {\n            self.handleBinaryFile(http.response, img, callback);\n          } else {\n            throw \"Could not load image\";\n          }\n          http = null;\n        };\n        http.open(\"GET\", img.src, true);\n        http.responseType = \"arraybuffer\";\n        http.send(null);\n      }\n    } else if (FileReader && (img instanceof window.Blob || img instanceof File)) {\n      var fileReader = new FileReader();\n      fileReader.onload = e => {\n        console.debug('getImageData: Got file of length %o', e.target.result.byteLength);\n        this.handleBinaryFile(e.target.result, img, callback);\n      };\n\n      fileReader.readAsArrayBuffer(img);\n    }\n  }\n\n  static getStringFromDB(buffer, start, length) {\n    var outstr = \"\";\n    for (var n = start; n < start + length; n++) {\n      outstr += String.fromCharCode(buffer.getUint8(n));\n    }\n    return outstr;\n  }\n\n  static readEXIFData(file, start) {\n    if (this.getStringFromDB(file, start, 4) != \"Exif\") {\n      console.error(\"Not valid EXIF data! \" + this.getStringFromDB(file, start, 4));\n      return false;\n    }\n\n    var bigEnd,\n      tags,\n      exifData, gpsData,\n      tiffOffset = start + 6;\n    let tag: string;\n\n    // test for TIFF validity and endianness\n    if (file.getUint16(tiffOffset) == 0x4949) {\n      bigEnd = false;\n    } else if (file.getUint16(tiffOffset) == 0x4D4D) {\n      bigEnd = true;\n    } else {\n      console.error(\"Not valid TIFF data! (no 0x4949 or 0x4D4D)\");\n      return false;\n    }\n\n    if (file.getUint16(tiffOffset + 2, !bigEnd) != 0x002A) {\n      console.error(\"Not valid TIFF data! (no 0x002A)\");\n      return false;\n    }\n\n    var firstIFDOffset = file.getUint32(tiffOffset + 4, !bigEnd);\n\n    if (firstIFDOffset < 0x00000008) {\n      console.error(\"Not valid TIFF data! (First offset less than 8)\", file.getUint32(tiffOffset + 4, !bigEnd));\n      return false;\n    }\n\n    tags = CropEXIF.readTags(file, tiffOffset, tiffOffset + firstIFDOffset, this.TiffTags, bigEnd);\n\n    if (tags.ExifIFDPointer) {\n      exifData = CropEXIF.readTags(file, tiffOffset, tiffOffset + tags.ExifIFDPointer, this.ExifTags, bigEnd);\n      for (tag in exifData) {\n        switch (tag) {\n          case \"LightSource\" :\n          case \"Flash\" :\n          case \"MeteringMode\" :\n          case \"ExposureProgram\" :\n          case \"SensingMethod\" :\n          case \"SceneCaptureType\" :\n          case \"SceneType\" :\n          case \"CustomRendered\" :\n          case \"WhiteBalance\" :\n          case \"GainControl\" :\n          case \"Contrast\" :\n          case \"Saturation\" :\n          case \"Sharpness\" :\n          case \"SubjectDistanceRange\" :\n          case \"FileSource\" :\n            exifData[tag] = this.StringValues[tag][exifData[tag]];\n            break;\n\n          case \"ExifVersion\" :\n          case \"FlashpixVersion\" :\n            exifData[tag] = String.fromCharCode(exifData[tag][0], exifData[tag][1], exifData[tag][2], exifData[tag][3]);\n            break;\n\n          case \"ComponentsConfiguration\" :\n            exifData[tag] =\n              this.StringValues.Components[exifData[tag][0]] +\n              this.StringValues.Components[exifData[tag][1]] +\n              this.StringValues.Components[exifData[tag][2]] +\n              this.StringValues.Components[exifData[tag][3]];\n            break;\n        }\n        tags[tag] = exifData[tag];\n      }\n    }\n\n    if (tags.GPSInfoIFDPointer) {\n      gpsData = this.readTags(file, tiffOffset, tiffOffset + tags.GPSInfoIFDPointer, this.GPSTags, bigEnd);\n      for (tag in gpsData) {\n        switch (tag) {\n          case \"GPSVersionID\" :\n            gpsData[tag] = gpsData[tag][0] +\n              \".\" + gpsData[tag][1] +\n              \".\" + gpsData[tag][2] +\n              \".\" + gpsData[tag][3];\n            break;\n        }\n        tags[tag] = gpsData[tag];\n      }\n    }\n\n    return tags;\n  }\n\n  static getData(img, callback) {\n    if ((img instanceof Image || img instanceof HTMLImageElement) && !img.complete) return false;\n\n    if (!this.imageHasData(img)) {\n      CropEXIF.getImageData(img, callback);\n    } else {\n      if (callback) {\n        callback.call(img);\n      }\n    }\n    return true;\n  };\n\n  static getTag(img, tag) {\n    if (!this.imageHasData(img)) return;\n    return img.exifdata[tag];\n  };\n\n  static getAllTags(img) {\n    if (!this.imageHasData(img)) return {};\n    var a,\n      data = img.exifdata,\n      tags = {};\n    for (a in data) {\n      if (data.hasOwnProperty(a)) {\n        tags[a] = data[a];\n      }\n    }\n    return tags;\n  };\n\n  static pretty(img) {\n    if (!this.imageHasData(img)) return \"\";\n    var a,\n      data = img.exifdata,\n      strPretty = \"\";\n    for (a in data) {\n      if (data.hasOwnProperty(a)) {\n        if (typeof data[a] == \"object\") {\n          if (data[a] instanceof Number) {\n            strPretty += a + \" : \" + data[a] + \" [\" + data[a].numerator + \"/\" + data[a].denominator + \"]\\r\\n\";\n          } else {\n            strPretty += a + \" : [\" + data[a].length + \" values]\\r\\n\";\n          }\n        } else {\n          strPretty += a + \" : \" + data[a] + \"\\r\\n\";\n        }\n      }\n    }\n    return strPretty;\n  }\n\n\n  static findEXIFinJPEG(file) {\n    var dataView = new DataView(file);\n    var maxOffset = dataView.byteLength - 4;\n\n    console.debug('findEXIFinJPEG: Got file of length %o', file.byteLength);\n    if (dataView.getUint16(0) !== 0xffd8) {\n      console.warn('Not a valid JPEG');\n      return false; // not a valid jpeg\n    }\n\n    var offset = 2;\n    var marker;\n\n    function readByte() {\n      var someByte = dataView.getUint8(offset);\n      offset++;\n      return someByte;\n    }\n\n    function readWord() {\n      var someWord = dataView.getUint16(offset);\n      offset = offset + 2;\n      return someWord;\n    }\n\n    while (offset < maxOffset) {\n      var someByte = readByte();\n      if (someByte != 0xFF) {\n        console.error('Not a valid marker at offset ' + offset + \", found: \" + someByte);\n        return false; // not a valid marker, something is wrong\n      }\n      marker = readByte();\n      console.debug('Marker=%o', marker);\n\n      // we could implement handling for other markers here,\n      // but we're only looking for 0xFFE1 for EXIF data\n\n      var segmentLength = readWord() - 2;\n      switch (marker) {\n        case '0xE1':\n          return this.readEXIFData(dataView, offset/*, segmentLength*/);\n        case '0xE0': // JFIF\n        default:\n          offset += segmentLength;\n      }\n    }\n  }\n\n  static findIPTCinJPEG(file) {\n    var dataView = new DataView(file);\n\n    console.debug('Got file of length ' + file.byteLength);\n    if ((dataView.getUint8(0) != 0xFF) || (dataView.getUint8(1) != 0xD8)) {\n      console.warn('Not a valid JPEG');\n      return false; // not a valid jpeg\n    }\n\n    var offset = 2,\n      length = file.byteLength;\n\n\n    var isFieldSegmentStart = function (dataView, offset) {\n      return (\n        dataView.getUint8(offset) === 0x38 &&\n        dataView.getUint8(offset + 1) === 0x42 &&\n        dataView.getUint8(offset + 2) === 0x49 &&\n        dataView.getUint8(offset + 3) === 0x4D &&\n        dataView.getUint8(offset + 4) === 0x04 &&\n        dataView.getUint8(offset + 5) === 0x04\n      );\n    };\n\n    while (offset < length) {\n      if (isFieldSegmentStart(dataView, offset)) {\n        // Get the length of the name header (which is padded to an even number of bytes)\n        var nameHeaderLength = dataView.getUint8(offset + 7);\n        if (nameHeaderLength % 2 !== 0) nameHeaderLength += 1;\n        // Check for pre photoshop 6 format\n        if (nameHeaderLength === 0) {\n          // Always 4\n          nameHeaderLength = 4;\n        }\n\n        var startOffset = offset + 8 + nameHeaderLength;\n        var sectionLength = dataView.getUint16(offset + 6 + nameHeaderLength);\n\n        return this.readIPTCData(file, startOffset, sectionLength);\n      }\n\n      // Not the marker, continue searching\n      offset++;\n    }\n  }\n\n  static readFromBinaryFile(file) {\n    return CropEXIF.findEXIFinJPEG(file);\n  }\n\n  static imageHasData(img) {\n    return !!(img.exifdata);\n  }\n\n  static base64ToArrayBuffer(base64, contentType?) {\n    contentType = contentType || base64.match(/^data\\:([^\\;]+)\\;base64,/mi)[1] || ''; // e.g. 'data:image/jpeg;base64,...' => 'image/jpeg'\n    base64 = base64.replace(/^data\\:([^\\;]+)\\;base64,/gmi, '');\n    var binary = atob(base64);\n    var len = binary.length;\n    var buffer = new ArrayBuffer(len);\n    var view = new Uint8Array(buffer);\n    for (var i = 0; i < len; i++) {\n      view[i] = binary.charCodeAt(i);\n    }\n    return buffer;\n  }\n}","/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)\r\n            t[p[i]] = s[p[i]];\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","export class CropCanvas {\n    // Shape = Array of [x,y]; [0, 0] - center\n    shapeArrowNW = [[-0.5, -2], [-3, -4.5], [-0.5, -7], [-7, -7], [-7, -0.5], [-4.5, -3], [-2, -0.5]];\n    shapeArrowNE = [[0.5, -2], [3, -4.5], [0.5, -7], [7, -7], [7, -0.5], [4.5, -3], [2, -0.5]];\n    shapeArrowSW = [[-0.5, 2], [-3, 4.5], [-0.5, 7], [-7, 7], [-7, 0.5], [-4.5, 3], [-2, 0.5]];\n    shapeArrowSE = [[0.5, 2], [3, 4.5], [0.5, 7], [7, 7], [7, 0.5], [4.5, 3], [2, 0.5]];\n    shapeArrowN = [[-1.5, -2.5], [-1.5, -6], [-5, -6], [0, -11], [5, -6], [1.5, -6], [1.5, -2.5]];\n    shapeArrowW = [[-2.5, -1.5], [-6, -1.5], [-6, -5], [-11, 0], [-6, 5], [-6, 1.5], [-2.5, 1.5]];\n    shapeArrowS = [[-1.5, 2.5], [-1.5, 6], [-5, 6], [0, 11], [5, 6], [1.5, 6], [1.5, 2.5]];\n    shapeArrowE = [[2.5, -1.5], [6, -1.5], [6, -5], [11, 0], [6, 5], [6, 1.5], [2.5, 1.5]];\n\n    // Colors\n    colors = {\n        areaOutline: '#fff',\n        resizeBoxStroke: '#fff',\n        resizeBoxFill: '#444',\n        resizeBoxArrowFill: '#fff',\n        resizeCircleStroke: '#fff',\n        resizeCircleFill: '#444',\n        moveIconFill: '#fff'\n    };\n\n    constructor(private ctx) {}\n\n    // Calculate Point\n    calcPoint(point, offset, scale) {\n        return [scale * point[0] + offset[0], scale * point[1] + offset[1]];\n    };\n\n    // Draw Filled Polygon\n    private drawFilledPolygon(shape, fillStyle, centerCoords, scale) {\n        this.ctx.save();\n        this.ctx.fillStyle = fillStyle;\n        this.ctx.beginPath();\n        var pc, pc0 = this.calcPoint(shape[0], centerCoords, scale);\n        this.ctx.moveTo(pc0[0], pc0[1]);\n\n        for (var p in shape) {\n            let pNum = parseInt(p, 10);\n            if (pNum > 0) {\n                pc = this.calcPoint(shape[pNum], centerCoords, scale);\n                this.ctx.lineTo(pc[0], pc[1]);\n            }\n        }\n\n        this.ctx.lineTo(pc0[0], pc0[1]);\n        this.ctx.fill();\n        this.ctx.closePath();\n        this.ctx.restore();\n    };\n\n    /* Icons */\n\n    drawIconMove(centerCoords, scale) {\n        this.drawFilledPolygon(this.shapeArrowN, this.colors.moveIconFill, centerCoords, scale);\n        this.drawFilledPolygon(this.shapeArrowW, this.colors.moveIconFill, centerCoords, scale);\n        this.drawFilledPolygon(this.shapeArrowS, this.colors.moveIconFill, centerCoords, scale);\n        this.drawFilledPolygon(this.shapeArrowE, this.colors.moveIconFill, centerCoords, scale);\n    }\n\n    drawIconResizeCircle(centerCoords, circleRadius, scale) {\n        var scaledCircleRadius = circleRadius * scale;\n        this.ctx.save();\n        this.ctx.strokeStyle = this.colors.resizeCircleStroke;\n        this.ctx.lineWidth = 2;\n        this.ctx.fillStyle = this.colors.resizeCircleFill;\n        this.ctx.beginPath();\n        this.ctx.arc(centerCoords[0], centerCoords[1], scaledCircleRadius, 0, 2 * Math.PI);\n        this.ctx.fill();\n        this.ctx.stroke();\n        this.ctx.closePath();\n        this.ctx.restore();\n    }\n\n    drawIconResizeBoxBase (centerCoords, boxSize, scale) {\n        var scaledBoxSize = boxSize * scale;\n        this.ctx.save();\n        this.ctx.strokeStyle = this.colors.resizeBoxStroke;\n        this.ctx.lineWidth = 2;\n        this.ctx.fillStyle = this.colors.resizeBoxFill;\n        this.ctx.fillRect(centerCoords[0] - scaledBoxSize / 2, centerCoords[1] - scaledBoxSize / 2, scaledBoxSize, scaledBoxSize);\n        this.ctx.strokeRect(centerCoords[0] - scaledBoxSize / 2, centerCoords[1] - scaledBoxSize / 2, scaledBoxSize, scaledBoxSize);\n        this.ctx.restore();\n    }\n    drawIconResizeBoxNESW(centerCoords, boxSize, scale) {\n        this.drawIconResizeBoxBase(centerCoords, boxSize, scale);\n        this.drawFilledPolygon(this.shapeArrowNE, this.colors.resizeBoxArrowFill, centerCoords, scale);\n        this.drawFilledPolygon(this.shapeArrowSW, this.colors.resizeBoxArrowFill, centerCoords, scale);\n    }\n    drawIconResizeBoxNWSE(centerCoords, boxSize, scale) {\n        this.drawIconResizeBoxBase(centerCoords, boxSize, scale);\n        this.drawFilledPolygon(this.shapeArrowNW, this.colors.resizeBoxArrowFill, centerCoords, scale);\n        this.drawFilledPolygon(this.shapeArrowSE, this.colors.resizeBoxArrowFill, centerCoords, scale);\n    }\n\n    /* Crop Area */\n\n    drawCropArea(image, centerCoords, size, fnDrawClipPath) {\n        var xRatio = image.width / this.ctx.canvas.width,\n            yRatio = image.height / this.ctx.canvas.height,\n            xLeft = centerCoords[0] - size / 2,\n            yTop = centerCoords[1] - size / 2;\n\n        this.ctx.save();\n        this.ctx.strokeStyle = this.colors.areaOutline;\n        this.ctx.lineWidth = 2;\n        this.ctx.beginPath();\n        fnDrawClipPath(this.ctx, centerCoords, size);\n        this.ctx.stroke();\n        this.ctx.clip();\n\n        // draw part of original image\n        if (size > 0) {\n            this.ctx.drawImage(image, xLeft * xRatio, yTop * yRatio, size * xRatio, size * yRatio, xLeft, yTop, size, size);\n        }\n\n        this.ctx.beginPath();\n        fnDrawClipPath(this.ctx, centerCoords, size);\n        this.ctx.stroke();\n        this.ctx.clip();\n\n        this.ctx.restore();\n    };\n}","import {CropCanvas} from \"./crop-canvas\";\n\nexport enum CropAreaType {\n  Square = 'square',\n  Circle = 'circle'\n}\n\nexport abstract class CropArea {\n  protected _minSize = 80;\n  protected _cropCanvas: CropCanvas;\n  protected _image = new Image();\n  protected _x = 0;\n  protected _y = 0;\n  protected _size = 200;\n\n  constructor(protected _ctx, protected _events) {\n    this._cropCanvas = new CropCanvas(_ctx);\n  }\n\n  getImage() {\n    return this._image;\n  }\n\n  setImage(image) {\n    this._image = image;\n  };\n\n  getX() {\n    return this._x;\n  };\n\n  setX(x) {\n    this._x = x;\n    this._dontDragOutside();\n  };\n\n  getY() {\n    return this._y;\n  };\n\n  setY(y) {\n    this._y = y;\n    this._dontDragOutside();\n  };\n\n  getSize() : number {\n    return this._size;\n  };\n\n  setSize(size) {\n    this._size = Math.max(this._minSize, size);\n    this._dontDragOutside();\n  };\n\n  getMinSize() {\n    return this._minSize;\n  };\n\n  setMinSize(size) {\n    this._minSize = size;\n    this._size = Math.max(this._minSize, this._size);\n    this._dontDragOutside();\n  };\n\n  _dontDragOutside() {\n    var h = this._ctx.canvas.height,\n      w = this._ctx.canvas.width;\n    if (this._size > w) {\n      this._size = w;\n    }\n    if (this._size > h) {\n      this._size = h;\n    }\n    if (this._x < this._size / 2) {\n      this._x = this._size / 2;\n    }\n    if (this._x > w - this._size / 2) {\n      this._x = w - this._size / 2;\n    }\n    if (this._y < this._size / 2) {\n      this._y = this._size / 2;\n    }\n    if (this._y > h - this._size / 2) {\n      this._y = h - this._size / 2;\n    }\n  };\n\n  abstract _drawArea(ctx, centerCoords, size);\n\n  draw() {\n    this._cropCanvas.drawCropArea(this._image, [this._x, this._y], this._size, this._drawArea);\n  };\n\n  abstract processMouseMove(mouseCurX: number, mouseCurY: number);\n\n  abstract processMouseDown(mouseDownX: number, mouseDownY: number);\n\n  abstract processMouseUp(mouseDownX: number, mouseDownY: number);\n}","import {CropArea} from \"./crop-area\";\n\nexport class CropAreaCircle extends CropArea {\n  _boxResizeBaseSize = 20;\n  _boxResizeNormalRatio = 0.9;\n  _boxResizeHoverRatio = 1.2;\n  _iconMoveNormalRatio = 0.9;\n  _iconMoveHoverRatio = 1.2;\n\n  _posDragStartX = 0;\n  _posDragStartY = 0;\n  _posResizeStartX = 0;\n  _posResizeStartY = 0;\n  _posResizeStartSize = 0;\n\n  _boxResizeIsHover = false;\n  _areaIsHover = false;\n  _boxResizeIsDragging = false;\n  _areaIsDragging = false;\n\n  private _boxResizeNormalSize: number;\n  private _boxResizeHoverSize: number;\n\n  constructor(ctx, events) {\n    super(ctx, events);\n\n    this._boxResizeNormalSize = this._boxResizeBaseSize * this._boxResizeNormalRatio;\n    this._boxResizeHoverSize = this._boxResizeBaseSize * this._boxResizeHoverRatio;\n  }\n\n  _calcCirclePerimeterCoords(angleDegrees) {\n    var hSize = this._size / 2;\n    var angleRadians = angleDegrees * (Math.PI / 180),\n      circlePerimeterX = this._x + hSize * Math.cos(angleRadians),\n      circlePerimeterY = this._y + hSize * Math.sin(angleRadians);\n    return [circlePerimeterX, circlePerimeterY];\n  }\n\n  _calcResizeIconCenterCoords() {\n    return this._calcCirclePerimeterCoords(-45);\n  }\n\n  _isCoordWithinArea(coord) {\n    return Math.sqrt((coord[0] - this._x) * (coord[0] - this._x) + (coord[1] - this._y) * (coord[1] - this._y)) < this._size / 2;\n  };\n\n  _isCoordWithinBoxResize(coord) {\n    var resizeIconCenterCoords = this._calcResizeIconCenterCoords();\n    var hSize = this._boxResizeHoverSize / 2;\n    return (coord[0] > resizeIconCenterCoords[0] - hSize && coord[0] < resizeIconCenterCoords[0] + hSize &&\n      coord[1] > resizeIconCenterCoords[1] - hSize && coord[1] < resizeIconCenterCoords[1] + hSize);\n  };\n\n  _drawArea(ctx, centerCoords, size) {\n    ctx.arc(centerCoords[0], centerCoords[1], size / 2, 0, 2 * Math.PI);\n  };\n\n  draw() {\n    CropArea.prototype.draw.apply(this, arguments);\n\n    // draw move icon\n    this._cropCanvas.drawIconMove([this._x, this._y], this._areaIsHover ? this._iconMoveHoverRatio : this._iconMoveNormalRatio);\n\n    // draw resize cubes\n    this._cropCanvas.drawIconResizeBoxNESW(this._calcResizeIconCenterCoords(), this._boxResizeBaseSize, this._boxResizeIsHover ? this._boxResizeHoverRatio : this._boxResizeNormalRatio);\n  };\n\n  processMouseMove(mouseCurX, mouseCurY) {\n    var cursor = 'default';\n    var res = false;\n\n    this._boxResizeIsHover = false;\n    this._areaIsHover = false;\n\n    if (this._areaIsDragging) {\n      this._x = mouseCurX - this._posDragStartX;\n      this._y = mouseCurY - this._posDragStartY;\n      this._areaIsHover = true;\n      cursor = 'move';\n      res = true;\n      this._events.trigger('area-move');\n    } else if (this._boxResizeIsDragging) {\n      cursor = 'nesw-resize';\n      var iFR, iFX, iFY;\n      iFX = mouseCurX - this._posResizeStartX;\n      iFY = this._posResizeStartY - mouseCurY;\n      if (iFX > iFY) {\n        iFR = this._posResizeStartSize + iFY * 2;\n      } else {\n        iFR = this._posResizeStartSize + iFX * 2;\n      }\n\n      this._size = Math.max(this._minSize, iFR);\n      this._boxResizeIsHover = true;\n      res = true;\n      this._events.trigger('area-resize');\n    } else if (this._isCoordWithinBoxResize([mouseCurX, mouseCurY])) {\n      cursor = 'nesw-resize';\n      this._areaIsHover = false;\n      this._boxResizeIsHover = true;\n      res = true;\n    } else if (this._isCoordWithinArea([mouseCurX, mouseCurY])) {\n      cursor = 'move';\n      this._areaIsHover = true;\n      res = true;\n    }\n\n    this._dontDragOutside();\n    this._ctx.canvas.style.cursor = cursor;\n\n    return res;\n  };\n\n  processMouseDown(mouseDownX: number, mouseDownY: number) {\n    if (this._isCoordWithinBoxResize([mouseDownX, mouseDownY])) {\n      this._areaIsDragging = false;\n      this._areaIsHover = false;\n      this._boxResizeIsDragging = true;\n      this._boxResizeIsHover = true;\n      this._posResizeStartX = mouseDownX;\n      this._posResizeStartY = mouseDownY;\n      this._posResizeStartSize = this._size;\n      this._events.trigger('area-resize-start');\n    } else if (this._isCoordWithinArea([mouseDownX, mouseDownY])) {\n      this._areaIsDragging = true;\n      this._areaIsHover = true;\n      this._boxResizeIsDragging = false;\n      this._boxResizeIsHover = false;\n      this._posDragStartX = mouseDownX - this._x;\n      this._posDragStartY = mouseDownY - this._y;\n      this._events.trigger('area-move-start');\n    }\n  };\n\n  processMouseUp(/*mouseUpX, mouseUpY*/) {\n    if (this._areaIsDragging) {\n      this._areaIsDragging = false;\n      this._events.trigger('area-move-end');\n    }\n    if (this._boxResizeIsDragging) {\n      this._boxResizeIsDragging = false;\n      this._events.trigger('area-resize-end');\n    }\n    this._areaIsHover = false;\n    this._boxResizeIsHover = false;\n\n    this._posDragStartX = 0;\n    this._posDragStartY = 0;\n  };\n\n}","import {CropArea} from \"./crop-area\";\n\nexport class CropAreaSquare extends CropArea {\n    _resizeCtrlBaseRadius = 10;\n    _resizeCtrlNormalRatio = 0.75;\n    _resizeCtrlHoverRatio = 1;\n    _iconMoveNormalRatio = 0.9;\n    _iconMoveHoverRatio = 1.2;\n\n    _posDragStartX = 0;\n    _posDragStartY = 0;\n    _posResizeStartX = 0;\n    _posResizeStartY = 0;\n    _posResizeStartSize = 0;\n\n    _resizeCtrlIsHover = -1;\n    _areaIsHover = false;\n    _resizeCtrlIsDragging = -1;\n    _areaIsDragging = false;\n\n    private _resizeCtrlNormalRadius: number;\n    private _resizeCtrlHoverRadius: number;\n\n    constructor(ctx, events) {\n        super(ctx, events);\n\n        this._resizeCtrlNormalRadius = this._resizeCtrlBaseRadius * this._resizeCtrlNormalRatio;\n        this._resizeCtrlHoverRadius = this._resizeCtrlBaseRadius * this._resizeCtrlHoverRatio;\n    };\n\n    _calcSquareCorners() {\n        var hSize = this._size / 2;\n        return [\n            [this._x - hSize, this._y - hSize],\n            [this._x + hSize, this._y - hSize],\n            [this._x - hSize, this._y + hSize],\n            [this._x + hSize, this._y + hSize]\n        ];\n    }\n\n    _calcSquareDimensions() {\n        var hSize = this._size / 2;\n        return {\n            left: this._x - hSize,\n            top: this._y - hSize,\n            right: this._x + hSize,\n            bottom: this._y + hSize\n        };\n    }\n\n    _isCoordWithinArea(coord) {\n        var squareDimensions = this._calcSquareDimensions();\n        return (coord[0] >= squareDimensions.left && coord[0] <= squareDimensions.right && coord[1] >= squareDimensions.top && coord[1] <= squareDimensions.bottom);\n    }\n\n    _isCoordWithinResizeCtrl(coord) {\n        var resizeIconsCenterCoords = this._calcSquareCorners();\n        var res = -1;\n        for (var i = 0, len = resizeIconsCenterCoords.length; i < len; i++) {\n            var resizeIconCenterCoords = resizeIconsCenterCoords[i];\n            if (coord[0] > resizeIconCenterCoords[0] - this._resizeCtrlHoverRadius && coord[0] < resizeIconCenterCoords[0] + this._resizeCtrlHoverRadius &&\n                coord[1] > resizeIconCenterCoords[1] - this._resizeCtrlHoverRadius && coord[1] < resizeIconCenterCoords[1] + this._resizeCtrlHoverRadius) {\n                res = i;\n                break;\n            }\n        }\n        return res;\n    }\n\n    _drawArea(ctx, centerCoords, size) {\n        var hSize = size / 2;\n        ctx.rect(centerCoords[0] - hSize, centerCoords[1] - hSize, size, size);\n    }\n\n    draw() {\n        CropArea.prototype.draw.apply(this, arguments);\n\n        // draw move icon\n        this._cropCanvas.drawIconMove([this._x, this._y], this._areaIsHover ? this._iconMoveHoverRatio : this._iconMoveNormalRatio);\n\n        // draw resize cubes\n        var resizeIconsCenterCoords = this._calcSquareCorners();\n        for (var i = 0, len = resizeIconsCenterCoords.length; i < len; i++) {\n            var resizeIconCenterCoords = resizeIconsCenterCoords[i];\n            this._cropCanvas.drawIconResizeCircle(resizeIconCenterCoords, this._resizeCtrlBaseRadius, this._resizeCtrlIsHover === i ? this._resizeCtrlHoverRatio : this._resizeCtrlNormalRatio);\n        }\n    }\n\n    processMouseMove(mouseCurX, mouseCurY) {\n        var cursor = 'default';\n        var res = false;\n\n        this._resizeCtrlIsHover = -1;\n        this._areaIsHover = false;\n\n        if (this._areaIsDragging) {\n            this._x = mouseCurX - this._posDragStartX;\n            this._y = mouseCurY - this._posDragStartY;\n            this._areaIsHover = true;\n            cursor = 'move';\n            res = true;\n            this._events.trigger('area-move');\n        } else if (this._resizeCtrlIsDragging > -1) {\n            var xMulti, yMulti;\n            switch (this._resizeCtrlIsDragging) {\n                case 0: // Top Left\n                    xMulti = -1;\n                    yMulti = -1;\n                    cursor = 'nwse-resize';\n                    break;\n                case 1: // Top Right\n                    xMulti = 1;\n                    yMulti = -1;\n                    cursor = 'nesw-resize';\n                    break;\n                case 2: // Bottom Left\n                    xMulti = -1;\n                    yMulti = 1;\n                    cursor = 'nesw-resize';\n                    break;\n                case 3: // Bottom Right\n                    xMulti = 1;\n                    yMulti = 1;\n                    cursor = 'nwse-resize';\n                    break;\n            }\n            var iFX = (mouseCurX - this._posResizeStartX) * xMulti;\n            var iFY = (mouseCurY - this._posResizeStartY) * yMulti;\n            var iFR;\n            if (iFX > iFY) {\n                iFR = this._posResizeStartSize + iFY;\n            } else {\n                iFR = this._posResizeStartSize + iFX;\n            }\n            var wasSize = this._size;\n            this._size = Math.max(this._minSize, iFR);\n            var posModifier = (this._size - wasSize) / 2;\n            this._x += posModifier * xMulti;\n            this._y += posModifier * yMulti;\n            this._resizeCtrlIsHover = this._resizeCtrlIsDragging;\n            res = true;\n            this._events.trigger('area-resize');\n        } else {\n            var hoveredResizeBox = this._isCoordWithinResizeCtrl([mouseCurX, mouseCurY]);\n            if (hoveredResizeBox > -1) {\n                switch (hoveredResizeBox) {\n                    case 0:\n                        cursor = 'nwse-resize';\n                        break;\n                    case 1:\n                        cursor = 'nesw-resize';\n                        break;\n                    case 2:\n                        cursor = 'nesw-resize';\n                        break;\n                    case 3:\n                        cursor = 'nwse-resize';\n                        break;\n                }\n                this._areaIsHover = false;\n                this._resizeCtrlIsHover = hoveredResizeBox;\n                res = true;\n            } else if (this._isCoordWithinArea([mouseCurX, mouseCurY])) {\n                cursor = 'move';\n                this._areaIsHover = true;\n                res = true;\n            }\n        }\n\n        this._dontDragOutside();\n        this._ctx.canvas.style.cursor = cursor;\n\n        return res;\n    }\n\n    processMouseDown(mouseDownX, mouseDownY) {\n        var isWithinResizeCtrl = this._isCoordWithinResizeCtrl([mouseDownX, mouseDownY]);\n        if (isWithinResizeCtrl > -1) {\n            this._areaIsDragging = false;\n            this._areaIsHover = false;\n            this._resizeCtrlIsDragging = isWithinResizeCtrl;\n            this._resizeCtrlIsHover = isWithinResizeCtrl;\n            this._posResizeStartX = mouseDownX;\n            this._posResizeStartY = mouseDownY;\n            this._posResizeStartSize = this._size;\n            this._events.trigger('area-resize-start');\n        } else if (this._isCoordWithinArea([mouseDownX, mouseDownY])) {\n            this._areaIsDragging = true;\n            this._areaIsHover = true;\n            this._resizeCtrlIsDragging = -1;\n            this._resizeCtrlIsHover = -1;\n            this._posDragStartX = mouseDownX - this._x;\n            this._posDragStartY = mouseDownY - this._y;\n            this._events.trigger('area-move-start');\n        }\n    }\n\n    processMouseUp(/*mouseUpX, mouseUpY*/) {\n        if (this._areaIsDragging) {\n            this._areaIsDragging = false;\n            this._events.trigger('area-move-end');\n        }\n        if (this._resizeCtrlIsDragging > -1) {\n            this._resizeCtrlIsDragging = -1;\n            this._events.trigger('area-resize-end');\n        }\n        this._areaIsHover = false;\n        this._resizeCtrlIsHover = -1;\n\n        this._posDragStartX = 0;\n        this._posDragStartY = 0;\n    }\n}","import {CropEXIF} from \"./crop-exif\";\nimport {CropAreaCircle} from \"./crop-area-circle\";\nimport {CropAreaSquare} from \"./crop-area-square\";\nimport {CropAreaType, CropArea} from \"./crop-area\";\nimport {CropAreaDetails} from \"../fc-img-crop.component\";\n\nexport class CropHost {\n\n  ctx = null;\n  image = null;\n\n  cropArea: CropArea;\n\n  // Dimensions\n  minCanvasDims = [100, 100];\n  maxCanvasDims = [300, 300];\n\n  resultImageSize = 200;\n  resultImageFormat = 'image/png';\n\n  resultImageQuality;\n\n  private element: any;\n\n  constructor(private elCanvas, private opts, private events) {\n    this.element = elCanvas.parentElement;\n\n    this.ctx = elCanvas.getContext('2d');\n\n    this.cropArea = new CropAreaCircle(this.ctx, events);\n\n    document.addEventListener('mousemove', this.onMouseMove.bind(this));\n    elCanvas.addEventListener('mousedown', this.onMouseDown.bind(this));\n    document.addEventListener('mouseup', this.onMouseUp.bind(this));\n\n    document.addEventListener('touchmove', this.onMouseMove.bind(this));\n    elCanvas.addEventListener('touchstart', this.onMouseDown.bind(this));\n    document.addEventListener('touchend', this.onMouseUp.bind(this));\n  }\n\n  destroy() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n    this.elCanvas.removeEventListener('mousedown', this.onMouseDown);\n    document.removeEventListener('mouseup', this.onMouseMove);\n\n    document.removeEventListener('touchmove', this.onMouseMove);\n    this.elCanvas.removeEventListener('touchstart', this.onMouseDown);\n    document.removeEventListener('touchend', this.onMouseMove);\n\n    this.elCanvas.remove();\n  }\n\n  drawScene() {\n    // clear canvas\n    this.ctx.clearRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n\n    if (this.image !== null) {\n      // draw source this.image\n      this.ctx.drawImage(this.image, 0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n      this.ctx.save();\n\n      // and make it darker\n      this.ctx.fillStyle = 'rgba(0, 0, 0, 0.65)';\n      this.ctx.fillRect(0, 0, this.ctx.canvas.width, this.ctx.canvas.height);\n\n      this.ctx.restore();\n\n      this.cropArea.draw();\n    }\n  }\n\n  resetCropHost(cw?, ch?) {\n    if (this.image !== null) {\n      this.cropArea.setImage(this.image);\n      var imageWidth = this.image.width || cw;\n      var imageHeight = this.image.height || ch;\n      var imageDims = [imageWidth, imageHeight];\n\n      // Compute canvas dimensions to fit full display into host\n      var imageRatio = imageWidth / imageHeight;\n      var canvasDims = imageDims;\n      if (canvasDims[0] > this.maxCanvasDims[0]) {\n        canvasDims[0] = this.maxCanvasDims[0];\n        canvasDims[1] = canvasDims[0] / imageRatio;\n      } else if (canvasDims[0] < this.minCanvasDims[0]) {\n        canvasDims[0] = this.minCanvasDims[0];\n        canvasDims[1] = canvasDims[0] / imageRatio;\n      }\n      if (canvasDims[1] > this.maxCanvasDims[1]) {\n        canvasDims[1] = this.maxCanvasDims[1];\n        canvasDims[0] = canvasDims[1] * imageRatio;\n      } else if (canvasDims[1] < this.minCanvasDims[1]) {\n        canvasDims[1] = this.minCanvasDims[1];\n        canvasDims[0] = canvasDims[1] * imageRatio;\n      }\n      var w = Math.floor(canvasDims[0]);\n      var h = Math.floor(canvasDims[1]);\n      canvasDims[0] = w;\n      canvasDims[1] = h;\n      console.debug('canvas reset =' + w + 'x' + h);\n      this.elCanvas.width = w;\n      this.elCanvas.height = h;\n\n      // Compensate CSS 50% centering of canvas inside host\n      this.elCanvas.style.marginLeft = -w / 2 + 'px';\n      this.elCanvas.style.marginTop = -h / 2 + 'px';\n\n      // Center crop area by default\n      this.cropArea.setX(this.ctx.canvas.width / 2);\n      this.cropArea.setY(this.ctx.canvas.height / 2);\n\n      this.cropArea.setSize(Math.min(200, this.ctx.canvas.width / 2, this.ctx.canvas.height / 2));\n    } else {\n      this.elCanvas.width = 0;\n      this.elCanvas.height = 0;\n      this.elCanvas.style.marginLeft = 0;\n      this.elCanvas.style.marginTop = 0;\n    }\n\n    this.drawScene();\n\n    return canvasDims;\n  }\n\n  /**\n   * Returns event.changedTouches directly if event is a TouchEvent.\n   * If event is a jQuery event, return changedTouches of event.originalEvent\n   */\n  static getChangedTouches(event) {\n    return event.changedTouches ? event.changedTouches : event.originalEvent.changedTouches;\n  }\n\n  onMouseMove(e) {\n    if (this.image !== null) {\n      var offset = CropHost.getElementOffset(this.ctx.canvas),\n        pageX, pageY;\n      if (e.type === 'touchmove') {\n        pageX = CropHost.getChangedTouches(e)[0].pageX;\n        pageY = CropHost.getChangedTouches(e)[0].pageY;\n      } else {\n        pageX = e.pageX;\n        pageY = e.pageY;\n      }\n      this.cropArea.processMouseMove(pageX - offset.left, pageY - offset.top);\n      this.drawScene();\n    }\n  }\n\n  onMouseDown(e) {\n    e.preventDefault();\n    e.stopPropagation();\n    if (this.image !== null) {\n      var offset = CropHost.getElementOffset(this.ctx.canvas),\n        pageX, pageY;\n      if (e.type === 'touchstart') {\n        pageX = CropHost.getChangedTouches(e)[0].pageX;\n        pageY = CropHost.getChangedTouches(e)[0].pageY;\n      } else {\n        pageX = e.pageX;\n        pageY = e.pageY;\n      }\n      this.cropArea.processMouseDown(pageX - offset.left, pageY - offset.top);\n      this.drawScene();\n    }\n  }\n\n  onMouseUp(e) {\n    if (this.image !== null) {\n      var offset = CropHost.getElementOffset(this.ctx.canvas),\n        pageX, pageY;\n      if (e.type === 'touchend') {\n        pageX = CropHost.getChangedTouches(e)[0].pageX;\n        pageY = CropHost.getChangedTouches(e)[0].pageY;\n      } else {\n        pageX = e.pageX;\n        pageY = e.pageY;\n      }\n      this.cropArea.processMouseUp(pageX - offset.left, pageY - offset.top);\n      this.drawScene();\n    }\n  }\n\n  getResultImageDataURI() {\n    var temp_canvas = <HTMLCanvasElement>document.createElement('CANVAS');\n    var temp_ctx = temp_canvas.getContext('2d');\n    temp_canvas.width = this.resultImageSize;\n    temp_canvas.height = this.resultImageSize;\n    if (this.image !== null) {\n      temp_ctx.drawImage(this.image,\n        (this.cropArea.getX() - this.cropArea.getSize() / 2) * (this.image.width / this.ctx.canvas.width),\n        (this.cropArea.getY() - this.cropArea.getSize() / 2) * (this.image.height / this.ctx.canvas.height),\n        this.cropArea.getSize() * (this.image.width / this.ctx.canvas.width),\n        this.cropArea.getSize() * (this.image.height / this.ctx.canvas.height),\n        0, 0, this.resultImageSize, this.resultImageSize);\n    }\n    if (this.resultImageQuality !== null) {\n      return temp_canvas.toDataURL(this.resultImageFormat, this.resultImageQuality);\n    }\n    return temp_canvas.toDataURL(this.resultImageFormat);\n  }\n\n  redraw() {\n    this.drawScene();\n  }\n\n  setNewImageSource(imageSource) {\n    this.image = null;\n    this.resetCropHost();\n    this.events.trigger('image-updated');\n    if (!!imageSource) {\n      var newImage = new Image();\n      if (imageSource.substring(0, 4).toLowerCase() === 'http') {\n        newImage.crossOrigin = 'anonymous';\n      }\n      const self = this;\n      newImage.onload = function () {\n        self.events.trigger('load-done');\n\n        CropEXIF.getData(newImage, () => {\n          var orientation = CropEXIF.getTag(newImage, 'Orientation');\n          let cw = newImage.width, ch = newImage.height, cx = 0, cy = 0, deg = 0;\n\n          function imageDone() {\n            console.debug('dims=' + cw + 'x' + ch);\n            var canvasDims = self.resetCropHost(cw, ch);\n            self.setMaxDimensions(canvasDims[0], canvasDims[1]);\n            self.events.trigger('image-updated');\n            self.events.trigger('image-ready');\n          }\n\n          if ([3, 6, 8].indexOf(orientation) >= 0) {\n            const canvas = document.createElement(\"canvas\");\n            const ctx = canvas.getContext(\"2d\");\n            switch (orientation) {\n              case 3:\n                cx = -newImage.width;\n                cy = -newImage.height;\n                deg = 180;\n                break;\n              case 6:\n                cw = newImage.height;\n                ch = newImage.width;\n                cy = -newImage.height;\n                deg = 90;\n                break;\n              case 8:\n                cw = newImage.height;\n                ch = newImage.width;\n                cx = -newImage.width;\n                deg = 270;\n                break;\n            }\n            canvas.width = cw;\n            canvas.height = ch;\n            self.ctx.rotate(deg * Math.PI / 180);\n            self.ctx.drawImage(newImage, cx, cy);\n\n            self.image = new Image();\n            self.image.onload = function () {\n              imageDone();\n            };\n            self.image.src = canvas.toDataURL(\"image/png\");\n          } else {\n            self.image = newImage;\n            imageDone();\n          }\n        });\n      };\n      newImage.onerror = error => {\n        this.events.trigger('load-error', [error]);\n      };\n      this.events.trigger('load-start');\n      newImage.src = imageSource;\n    }\n  }\n\n  setMaxDimensions(width, height) {\n    console.debug('setMaxDimensions(' + width + ', ' + height + ')');\n    if (this.image !== null) {\n      const curWidth = this.ctx.canvas.width,\n        curHeight = this.ctx.canvas.height;\n\n      const ratioNewCurWidth = this.ctx.canvas.width / curWidth,\n        ratioNewCurHeight = this.ctx.canvas.height / curHeight,\n        ratioMin = Math.min(ratioNewCurWidth, ratioNewCurHeight);\n    }\n    this.maxCanvasDims = [width, height];\n    return this.resetCropHost(width, height);\n  }\n\n  setAreaMinSize(size) {\n    size = parseInt(size, 10);\n    if (!isNaN(size)) {\n      this.cropArea.setMinSize(size);\n      this.drawScene();\n    }\n  }\n\n  setResultImageSize(size) {\n    size = parseInt(size, 10);\n    if (!isNaN(size)) {\n      this.resultImageSize = size;\n    }\n  }\n\n  setResultImageFormat(format) {\n    this.resultImageFormat = format;\n  }\n\n  setResultImageQuality(quality) {\n    quality = parseFloat(quality);\n    if (!isNaN(quality) && quality >= 0 && quality <= 1) {\n      this.resultImageQuality = quality;\n    }\n  }\n\n  setAreaType(type: CropAreaType) {\n    const curSize = this.cropArea.getSize(),\n      curMinSize = this.cropArea.getMinSize(),\n      curX = this.cropArea.getX(),\n      curY = this.cropArea.getY();\n\n    if (type === CropAreaType.Square) {\n      this.cropArea = new CropAreaSquare(this.ctx, this.events);\n    } else {\n      this.cropArea = new CropAreaCircle(this.ctx, this.events);\n    }\n    this.cropArea.setMinSize(curMinSize);\n    this.cropArea.setSize(curSize);\n    this.cropArea.setX(curX);\n    this.cropArea.setY(curY);\n\n    // this.resetCropHost();\n    if (this.image !== null) {\n      this.cropArea.setImage(this.image);\n    }\n    this.drawScene();\n  }\n\n  getAreaDetails() : CropAreaDetails {\n    return {\n      x: this.cropArea.getX(),\n      y: this.cropArea.getY(),\n      size: this.cropArea.getSize(),\n      image: {width: this.cropArea.getImage().width, height: this.cropArea.getImage().height},\n      canvas: {width: this.ctx.canvas.width, height: this.ctx.canvas.height}\n    };\n  }\n\n  static getElementOffset(elem) {\n    var box = elem.getBoundingClientRect();\n\n    var body = document.body;\n    var docElem = document.documentElement;\n\n    var scrollTop = window.pageYOffset || docElem.scrollTop || body.scrollTop;\n    var scrollLeft = window.pageXOffset || docElem.scrollLeft || body.scrollLeft;\n\n    var clientTop = docElem.clientTop || body.clientTop || 0;\n    var clientLeft = docElem.clientLeft || body.clientLeft || 0;\n\n    var top = box.top + scrollTop - clientTop;\n    var left = box.left + scrollLeft - clientLeft;\n\n    return {top: Math.round(top), left: Math.round(left)};\n  }\n}","import {\n  AfterViewInit, ChangeDetectorRef,\n  Component,\n  ElementRef,\n  EventEmitter,\n  Input,\n  OnChanges,\n  OnDestroy,\n  OnInit,\n  Output,\n  SimpleChanges, ViewEncapsulation\n} from '@angular/core';\nimport {CropPubSub} from \"./classes/crop-pubsub\";\nimport {CropHost} from \"./classes/crop-host\";\nimport {CropAreaType} from \"./classes/crop-area\";\n\nexport interface CropAreaDetails {\n  x: number;\n  y: number;\n  size: number;\n  image: { width: number, height: number };\n  canvas: { width: number, height: number };\n}\n\n@Component({\n  selector: 'fc-img-crop',\n  template: '<canvas></canvas>',\n  styleUrls: ['fc-img-crop.component.scss']\n})\nexport class FcImgCropComponent implements OnChanges, OnInit, AfterViewInit, OnDestroy {\n\n  @Input() image;\n\n  @Input() resultImage;\n  @Output() resultImageChange = new EventEmitter();\n\n  @Input() changeOnFly;\n  @Input() areaType: CropAreaType;\n  @Input() areaMinSize;\n\n  @Input() areaDetails: CropAreaDetails;\n  @Output() areaDetailsChange = new EventEmitter<CropAreaDetails>();\n\n  @Input() resultImageSize;\n  @Input() resultImageFormat: string;\n  @Input() resultImageQuality;\n\n  @Output() onChange = new EventEmitter();\n  @Output() onLoadBegin = new EventEmitter();\n  @Output() onLoadDone = new EventEmitter();\n  @Output() onLoadError = new EventEmitter();\n  @Output() onImageReady = new EventEmitter();\n\n  private events = new CropPubSub();\n  private cropHost: CropHost;\n  private observer: MutationObserver;\n\n  constructor(private el: ElementRef, private ref: ChangeDetectorRef) {\n  }\n\n  ngOnInit() {\n    const events = this.events;\n\n    // Init Crop Host\n    let el = this.el.nativeElement.querySelector('canvas');\n    this.cropHost = new CropHost(el, {}, events);\n\n    // Setup CropHost Event Handlers\n    const self = this;\n    events\n      .on('load-start', () => {\n        self.onLoadBegin.emit({});\n        self.ref.detectChanges();\n      })\n      .on('load-done', () => {\n        self.onLoadDone.emit({});\n        self.ref.detectChanges();\n      })\n      .on('image-ready', () => {\n        if (self.onImageReady.emit({})) {\n          self.cropHost.redraw();\n          self.ref.detectChanges();\n        }\n      })\n      .on('load-error', () => {\n        self.onLoadError.emit({});\n        self.ref.detectChanges();\n      })\n      .on('area-move area-resize', () => {\n        if (!!self.changeOnFly) {\n          self.updateResultImage();\n          self.ref.detectChanges();\n        }\n      })\n      .on('area-move-end area-resize-end image-updated', () => {\n        self.updateResultImage();\n        self.areaDetails = self.cropHost.getAreaDetails();\n        self.areaDetailsChange.emit(self.areaDetails);\n      });\n  }\n\n  // Store Result Image to check if it's changed\n  storedResultImage;\n\n  updateResultImage() {\n    const resultImage = this.cropHost.getResultImageDataURI();\n    if (this.storedResultImage !== resultImage) {\n      this.storedResultImage = resultImage;\n      this.resultImage = resultImage;\n      if (this.resultImageChange.observers.length) {\n        this.resultImageChange.emit(this.resultImage);\n      }\n      if (this.onChange.observers.length > 0) {\n        this.onChange.emit({$dataURI: this.resultImage});\n      }\n    }\n  }\n\n  ngOnDestroy(): void {\n    this.cropHost.destroy();\n  }\n\n  /**\n   * Sync CropHost with Directive's options\n   */\n  ngOnChanges(changes: SimpleChanges): void {\n    if (this.cropHost) {\n      if (changes.image) {\n        this.cropHost.setNewImageSource(this.image);\n      }\n      if (changes.areaType) {\n        this.cropHost.setAreaType(this.areaType);\n        this.updateResultImage();\n      }\n      if (changes.areaMinSize) {\n        this.cropHost.setAreaMinSize(this.areaMinSize);\n        this.updateResultImage();\n      }\n      if (changes.resultImageSize) {\n        this.cropHost.setResultImageSize(this.resultImageSize);\n        this.updateResultImage();\n      }\n      if (changes.resultImageFormat) {\n        this.cropHost.setResultImageFormat(this.resultImageFormat);\n        this.updateResultImage();\n      }\n      if (changes.resultImageQuality) {\n        this.cropHost.setResultImageQuality(this.resultImageQuality);\n        this.updateResultImage();\n      }\n    }\n  }\n\n  ngAfterViewInit(): void {\n    this.observer = new MutationObserver(mutations => {\n      mutations.forEach((mutation: MutationRecord) => {\n        if (mutation.attributeName === 'clientWidth' || mutation.attributeName === 'clientHeight') {\n          this.cropHost.setMaxDimensions(this.el.nativeElement.clientWidth, this.el.nativeElement.clientHeight);\n          this.updateResultImage();\n        }\n      });\n    });\n    const config = {attributes: true, childList: true, characterData: true};\n    this.observer.observe(this.el.nativeElement, config);\n  }\n}","import {NgModule} from '@angular/core';\n\nimport {FcImgCropComponent} from \"./fc-img-crop.component\";\n\n@NgModule({\n    declarations: [\n        FcImgCropComponent\n    ],\n    exports: [\n        FcImgCropComponent\n    ]\n})\nexport class CropModule {\n}\n"]}